# Experiment 5: Subqueries and Views

## AIM
To study and implement subqueries and views.

## THEORY

### Subqueries
A subquery is a query inside another SQL query and is embedded in:
- WHERE clause
- HAVING clause
- FROM clause

**Types:**
- **Single-row subquery**:
  Sub queries can also return more than one value. Such results should be made use along with the operators in and any.
- **Multiple-row subquery**:
  Here more than one subquery is used. These multiple sub queries are combined by means of ‘and’ & ‘or’ keywords.
- **Correlated subquery**:
  A subquery is evaluated once for the entire parent statement whereas a correlated Sub query is evaluated once per row processed by the parent statement.

**Example:**
```sql
SELECT * FROM employees
WHERE salary > (SELECT AVG(salary) FROM employees);
```
### Views
A view is a virtual table based on the result of an SQL SELECT query.
**Create View:**
```sql
CREATE VIEW view_name AS
SELECT column1, column2 FROM table_name WHERE condition;
```
**Drop View:**
```sql
DROP VIEW view_name;
```

**Question 1**
--
Write a SQL query that retrieves the names of students and their corresponding grades, where the grade is equal to the maximum grade achieved in each subject.
<br>
<br>
Sample table: GRADES (attributes: student_id, student_name, subject, grade)
```sql
select student_name,grade from grades g
where g.grade = (select  MAX(g2.grade)
                 from grades g2
                 where g2.subject = g.subject);
```

**Output:**
![440642325-c1758651-2bc7-4b52-94aa-140cad0bcd03](https://github.com/user-attachments/assets/dc1a0226-07ea-482f-8ab7-372a8b3692ad)


**Question 2**
---
Write a SQL query to List departments with names longer than the average length
<br>
<br>
Departments Table (attributes: department_id, department_name)

```sql
SELECT department_id as depar, department_name
FROM Departments
WHERE LENGTH(department_name) > (
    SELECT AVG(LENGTH(department_name)) FROM Departments
);

```

**Output:**

![440642498-c6a5f2e6-4f61-48db-b2f4-c72c228eb8ce](https://github.com/user-attachments/assets/d04474bb-9c25-4e65-9866-f9e2a9016f4f)


**Question 3**
---
Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose salary is EQUAL TO $1500.

```
Sample table: CUSTOMERS

ID          NAME        AGE         ADDRESS     SALARY
----------  ----------  -------- ----------  ----------

1          Ramesh       32          Ahmedabad     2000
2          Khilan       25          Delhi         1500
3          Kaushik      23          Kota          2000
4          Chaitali     25          Mumbai        6500
5          Hardik       27          Bhopal        8500
6          Komal        22          Hyderabad     4500
7          Muffy        24          Indore        10000

```

```sql
SELECT * from CUSTOMERS
WHERE SALARY=1500;
```

**Output:**

![440642731-450c8933-6604-4de3-af1b-5b8e0c936738](https://github.com/user-attachments/assets/d87fd8a9-beec-4280-9514-093cdcfc3eb0)


**Question 4**
---
From the following tables, write a SQL query to find all orders generated by the salespeople who may work for customers whose id is 3007. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.
```
Table Name: orders

name             type
---------------  --------
order_no         int
purch_amt        real
order_date       text
customer_id      int
salesman_id      int
```


```sql
select ord_no,purch_amt,ord_date,customer_id,salesman_id
from orders 
where salesman_id =(
    select salesman_id 
    from orders 
    where customer_id=3007
);
```

**Output:**
![440648173-1fe61767-8ef6-46dd-bbeb-6d73feeee28b](https://github.com/user-attachments/assets/afdd388e-95b4-4871-8604-a216a402ca06)



**Question 5**
---
From the following tables write a SQL query to find all orders generated by New York-based salespeople. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.
```
salesman table

name             type
---------------  ---------------
salesman_id      numeric(5)
name             varchar(30)
city             varchar(15)
commission       decimal(5,2)

orders table

name             type
---------------  --------
order_no         int
purch_amt        real
order_date       text
customer_id      int
salesman_id      int
```

```sql
select ord_no,purch_amt,ord_date,customer_id,salesman_id from orders
WHERE salesman_id IN(select salesman_id from salesman where city = 'New York');
```

**Output:**

![440648377-6b6c3f52-6b95-4599-9a0b-e15c2e67a63f](https://github.com/user-attachments/assets/4bce5333-b7f0-4d0d-b7eb-6a0e4acc59da)


**Question 6**
---
From the following tables write a SQL query to find all orders generated by London-based salespeople. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.

```
salesman table

name             type
---------------  ---------------
salesman_id      numeric(5)
name             varchar(30)
city             varchar(15)
commission       decimal(5,2)

orders table

name             type
---------------  --------
order_no         int
purch_amt        real
order_date       text
customer_id      int
salesman_id      int
```

```sql
SELECT  ord_no,purch_amt,ord_date,customer_id,salesman_id
FROM orders
where salesman_id In(
      select salesman_id
      from salesman 
      where city ='London'
);
```

**Output:**
![440648624-1542a4be-90b9-4dd3-9017-438364bbcd74](https://github.com/user-attachments/assets/1f451016-761a-4f22-af05-a976acfc17a2)


**Question 7**
---
 Write a SQL query to Retrieve the medications with dosages equal to the lowest dosage

Table Name: Medications (attributes: medication_id, medication_name, dosage)

```sql
SELECT medication_id as medic,medication_name,dosage
from Medications
where dosage IN(select MIN(dosage) from Medications);
```

**Output:**
![440648868-ffd45e30-73f9-46c6-8d59-59e1579043e8](https://github.com/user-attachments/assets/ff21300a-ea4e-410c-998f-dbdd02cb24cd)



**Question 8**
---
Write a SQL query that retrieves the all the columns from the Table Grades, where the grade is equal to the minimum grade achieved in each subject.
<br>
<br>
Sample table: GRADES (attributes: student_id, student_name, subject, grade)

```sql
select * from GRADES g
where g.grade = (SELECT MIN(g2.grade)from Grades g2 where g2.subject=g.subject);
```

**Output:**

![440649565-67d1929d-8466-444e-9bdd-dbefe42aacc4](https://github.com/user-attachments/assets/439082b6-aa4d-42ff-8059-400e6c08df8b)


**Question 9**
---
Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose AGE is LESS than $30
```
Sample table: CUSTOMERS

ID          NAME        AGE         ADDRESS     SALARY
----------  ----------  ----------  ----------  ----------

1          Ramesh        32           Ahmedabad     2000
2          Khilan        25           Delhi         1500
3          Kaushik       23           Kota          2000
4          Chaitali      25           Mumbai        6500
5          Hardik        27           Bhopal        8500
6          Komal         22           Hyderabad     500
7          Muffy         24           Indore        10000
```

```sql
select * from CUSTOMERS WHERE age<30 order by ID;
```

**Output:**
![440649463-8fb5a23e-67c1-466b-86f2-fa9f706f69a0](https://github.com/user-attachments/assets/ec622c83-fd5e-4b40-9f9e-ca6b8b720009)



**Question 10**
---
Write a SQL query that retrieves the names of students and their corresponding grades, where the grade is equal to the minimum grade achieved in each subject.
<br>
<br>

Sample table: GRADES (attributes: student_id, student_name, subject, grade)

```sql
select student_name,grade from GRADES g 
where g.grade =(select MIN(g2.grade)from GRADES g2 where g2.subject=g.subject);
```

**Output:**
![440649016-5e699fde-8558-4792-81a6-0d7de3c2d0e7](https://github.com/user-attachments/assets/93813f65-1f18-405d-a6bc-4187fe76a35b)



## RESULT
Thus, the SQL queries to implement subqueries and views have been executed successfully.
